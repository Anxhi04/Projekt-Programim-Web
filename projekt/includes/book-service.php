<?php
include('header.php')
?>
<DOCTYPE html>
    <html>
         <head>
             <link href="css\book-service.css" rel="stylesheet">

         </head>
         <body>
         <h6>Our Services</h6>
         <p class="text"> Select a service and choose your prefered date and time</p>
         <br>
             <div class="container">
                 <div class="card">
                     <div class="card-header">
                         Hair
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Haircut & Styling</h5>
                         <p class="card-text">Professional haircut and styling tailored to your face shape and preferences.</p>
                         <div class="price-time">
                             <span>15â‚¬</span>
                             <span>45 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Hair
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Haircut</h5>
                         <p class="card-text">Classic or modern haircut customized to your style.</p>
                         <div class="price-time">
                             <span>12â‚¬</span>
                             <span>30min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Hair
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Wash & Blow-Dry</h5>
                         <p class="card-text">Hair wash with professional products followed by a smooth or voluminous blow-dry.</p>
                         <div class="price-time">
                             <span>8â‚¬</span>
                             <span>30min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Hair Coloring
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Full Hair Coloring</h5>
                         <p class="card-text">Complete hair coloring using high-quality professional dyes.</p>
                         <div class="price-time">
                             <span>30â‚¬</span>
                             <span>90min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Hair Coloring
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Root Touch Up</h5>
                         <p class="card-text">Color refresh for roots to maintain an even tone.</p>
                         <div class="price-time">
                             <span>20â‚¬</span>
                             <span>60min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Hair Coloring
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Balayage</h5>
                         <p class="card-text">Natural-looking highlights for a modern, sun-kissed effect.</p>
                         <div class="price-time">
                             <span>80â‚¬</span>
                             <span>120min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Hair Coloring
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Highlights</h5>
                         <p class="card-text">Classic or modern highlights for added dimension and brightness.</p>
                         <div class="price-time">
                             <span>60â‚¬</span>
                             <span>100 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Treatments
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Hair Mask & Treatment</h5>
                         <p class="card-text">Deep conditioning treatment to restore and nourish damaged hair.</p>
                         <div class="price-time">
                             <span>15â‚¬</span>
                             <span>30 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Treatments
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Keratin Treatment</h5>
                         <p class="card-text">Smoothing treatment that reduces frizz and adds shine.</p>
                         <div class="price-time">
                             <span>70â‚¬</span>
                             <span>120 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Treatments
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Botox Hair Treatment</h5>
                         <p class="card-text">Intensive repair treatment for dry and damaged hair.</p>
                         <div class="price-time">
                             <span>50â‚¬</span>
                             <span>90 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Styling
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Blow-Dry Styling</h5>
                         <p class="card-text">Professional blow-dry for a polished everyday look.</p>
                         <div class="price-time">
                             <span>10â‚¬</span>
                             <span>30 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Styling
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Curling / Waves</h5>
                         <p class="card-text">Soft curls or beach waves for a stylish finish.</p>
                         <div class="price-time">
                             <span>12â‚¬</span>
                             <span>30 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Styling
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Hair Straightening</h5>
                         <p class="card-text">Sleek and smooth straightening using professional tools.</p>
                         <div class="price-time">
                             <span>12â‚¬</span>
                             <span>30 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Bridal & Events
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Bridal Hairstyle</h5>
                         <p class="card-text">Elegant and long-lasting hairstyle for your special day.</p>
                         <div class="price-time">
                             <span>60â‚¬</span>
                             <span>90 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Bridal & Events
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Event / Evening Hairstyle</h5>
                         <p class="card-text">Glamorous hairstyle for parties and special occasions.</p>
                         <div class="price-time">
                             <span>30â‚¬</span>
                             <span>60 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Care & Extras
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Hair Consultation</h5>
                         <p class="card-text">Personalized consultation to choose the best style or treatment.</p>
                         <div class="price-time">
                             <span>Free</span>
                             <span>15 min</span>
                         </div>
                     </div>
                 </div>
                 <div class="card">
                     <div class="card-header">
                         Care & Extras
                     </div>
                     <div class="card-body">
                         <h5 class="card-title">Hair Extensions Consultation</h5>
                         <p class="card-text">Consultation for hair extensions, color matching and method selection.</p>
                         <div class="price-time">
                             <span>Free</span>
                             <span>20 min</span>
                         </div>
                     </div>
                 </div>
             </div>
             <form method="post">
                 <div class="book-info justify-content-center my-4" id="book">
                     <div class="card">
                         <div class="card-header">
                         </div>
                         <div class="card-body">
                             Select date:
                             <input type="date" class="form-control" id="dateInput">
                             <br>
                             <div class="d-flex flex-wrap gap-2 hidden" id="timeSlots">
                                 <span>Select time:</span>
                             </div>
                             <br>
                             <div class="card mb-3 total-info" id="total-info" >
                                 <div class="card-body text-success">
                                     <div class="summary-item">
                                         <span class="label">Service:</span>
                                         <span class="text-end"></span>
                                     </div>
                                     <div class="summary-item">
                                         <span class="label">Date:</span>
                                         <span class="text-end"></span>
                                     </div>
                                     <div class="summary-item">
                                         <span class="label">Time:</span>
                                         <span class="text-end"></span>
                                     </div>
                                     <div class="summary-item">
                                         <span class="label">Duration:</span>
                                         <span class="text-end"></span>
                                     </div>

                                 </div>
                                 <div class="card-footer bg-transparent ">
                                     <div class="summary-item">
                                         <span class="label">Total:</span>
                                         <span class="text-end"></span>
                                     </div>
                                 </div>
                             </div>
                             <br>
                             <div class="d-grid gap-2 d-md-block" >
                                 <button class="btn btn-primary" id="bookBtn" type="submit" >ðŸ“†Book</button>
                             </div>
                         </div>
                     </div>
                 </div>
             </form>

         <script>
             document.addEventListener("DOMContentLoaded", () => {
                 const cards = document.querySelectorAll(".container .card");
                 const book = document.getElementById("book");
                 const timeslots = document.getElementById("timeSlots");
                 const dateInput = document.getElementById("dateInput");
                 const bookBtn = document.getElementById("bookBtn");
                 const totalInfo = document.getElementById("total-info");

                 //  4 span-at te summary (Service, Date, Time, Duration)
                 const infoSpans = document.querySelectorAll(".summary-item .text-end");
                 const totalSpan = document.querySelector(".card-footer .text-end");

                 let selectedServiceTitle = null;
                 let selectedServiceDuration = null;
                 let selectedServicePrice = null;
                 let selectedtime = null;

                 //sigurohet ti kalojme funksionit nje string
                 function parseMinutes(text) {
                     return parseInt(String(text).replace(/[^\d]/g, ""), 10);
                 }

                 // percakton timeslotet sipas sherbimit te zgjedhur
                 function renderTimeSlots(duration) {
                     timeslots.innerHTML = "<span>Select time:</span>";

                     const startHour = 9;
                     const endHour = 20;

                     let startMinutes = startHour * 60;
                     const endMinutes = endHour * 60;
                     //kushti qe oraret te jen per aqa koh sa punon dyqani
                     while (startMinutes + duration <= endMinutes) {
                         const h = String(Math.floor(startMinutes / 60)).padStart(2, "0");
                         const m = String(startMinutes % 60).padStart(2, "0");
                         const timeLabel = `${h}:${m}`;

                         const btn = document.createElement("button");
                         btn.type = "button";
                         btn.className = "btn btn-outline-secondary time-slot";
                         btn.textContent = timeLabel;

                         //kur klikohet btn krijuar
                         btn.addEventListener("click", () => {

                             timeslots.querySelectorAll(".time-slot").forEach(b => b.classList.remove("active-slot"));
                             btn.classList.add("active-slot");

                             selectedtime = timeLabel;

                             // plotesojme te dhenat
                             infoSpans[0].textContent = selectedServiceTitle || "";
                             infoSpans[1].textContent = dateInput.value || "";
                             infoSpans[2].textContent = selectedtime || "";
                             infoSpans[3].textContent = (selectedServiceDuration ? `${selectedServiceDuration} min` : "");

                             if (totalSpan) totalSpan.textContent = (selectedServicePrice ? `${selectedServicePrice}` : "");

                             totalInfo.classList.remove("total-info");
                             bookBtn.style.display = "inline-block";
                             totalInfo.scrollIntoView({ behavior: "smooth", block: "end" });
                         });

                         timeslots.appendChild(btn);
                         startMinutes += duration;
                     }

                     timeslots.classList.remove("hidden");
                     timeslots.style.display = "flex";
                 }

                 // siguron qe slots te krijohen vtm eshte eshte zgjedh service dhe data
                 function tryGenerateSlots() {
                     if (!selectedServiceDuration) return;
                     if (!dateInput.value) return;
                     selectedtime = null;
                     renderTimeSlots(selectedServiceDuration);
                 }

                 //kur zgjedhim sherbimin
                 cards.forEach(card => {
                     card.addEventListener("click", () => {
                         selectedServiceTitle = card.querySelector(".card-title")?.innerText?.trim() || "";

                         // merr duration dhe price nga card-i i klikuar
                         const durationText = card.querySelector(".price-time span:nth-child(2)")?.textContent || "";
                         const priceText = card.querySelector(".price-time span:nth-child(1)")?.textContent || "";

                         selectedServiceDuration = parseMinutes(durationText);
                         selectedServicePrice = priceText;


                         book.querySelector(".card-header").innerText = `Book ${selectedServiceTitle}`;
                         book.style.display = "block";
                         book.scrollIntoView({ behavior: "smooth", block: "start" });

                         // vendos duration te summary
                         infoSpans[0].textContent = selectedServiceTitle;
                         infoSpans[3].textContent = `${selectedServiceDuration} min`;
                         if (totalSpan) totalSpan.textContent = selectedServicePrice;

                         tryGenerateSlots();
                     });
                 });

                 // nese ndryshojme daten
                 dateInput.addEventListener("change", () => {
                     infoSpans[1].textContent = dateInput.value;
                     tryGenerateSlots();
                 });

                 // kur klikojme book
                 bookBtn.addEventListener("click", (e) => {
                     e.preventDefault();

                     if (!selectedServiceTitle || !dateInput.value || !selectedtime) {
                         alert("Select service, date and time first!");
                         return;
                     }

                     const data = new FormData();
                     data.append("action", "book");
                     data.append("service", selectedServiceTitle);
                     data.append("date", dateInput.value);
                     data.append("time", selectedtime);
                     data.append("price", selectedServicePrice )

                     fetch("/projekt/includes/bookservicepart2.php", {
                         method: "POST",
                         body: data
                     });
                 });
             });


         </script>
         </body>
    </html>
</DOCTYPE>

